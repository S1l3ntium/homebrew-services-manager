.PHONY: help build build-cli build-app clean test run run-cli run-app install

help: ## –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É
	@echo "–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "  \033[36m%-15s\033[0m %s\n", $$1, $$2}'

build: ## –°–æ–±—Ä–∞—Ç—å CLI –∏ App
	@BUILD_APP=1 ./build.sh

build-cli: ## –°–æ–±—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ CLI
	@./build.sh

build-app: ## –°–æ–±—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ GUI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
	@swift build -c release --product HomebrewServicesManager
	@mkdir -p dist
	@cp .build/release/HomebrewServicesManager dist/
	@echo "‚úÖ Built App to dist/HomebrewServicesManager"

clean: ## –û—á–∏—Å—Ç–∏—Ç—å build –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
	@swift package clean
	@rm -rf dist
	@echo "üßπ Cleaned build artifacts"

test: ## –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
	@swift test

run: run-app ## –ó–∞–ø—É—Å—Ç–∏—Ç—å GUI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

run-cli: build-cli ## –°–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å CLI
	@./dist/hsmanager-cli

run-app: build-app ## –°–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å GUI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
	@./dist/HomebrewServicesManager

install: build ## –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å CLI –≤ /usr/local/bin
	@echo "Installing hsmanager-cli to /usr/local/bin..."
	@sudo cp dist/hsmanager-cli /usr/local/bin/
	@sudo chmod +x /usr/local/bin/hsmanager-cli
	@echo "‚úÖ Installed hsmanager-cli"

format: ## –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω swift-format)
	@if command -v swift-format >/dev/null 2>&1; then \
		swift-format -i -r Sources Tests; \
		echo "‚úÖ Formatted code"; \
	else \
		echo "‚ö†Ô∏è  swift-format not installed. Run: brew install swift-format"; \
	fi

.DEFAULT_GOAL := help
